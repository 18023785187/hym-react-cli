#!/usr/bin/env node
const program = require('commander')
const { promisify } = require('util')
const figlet = promisify(require('figlet'))
const chalk = require('chalk')
const create = require('../lib/create')

const packageJson = require('../package.json')
program.version(packageJson.version, '-v, --V', 'è¾“å‡ºç‰ˆæœ¬å·')

program
    .argument('<projectName>')
    .option('--template <template>', 'å¯é€‰æ¨¡æ¿, <template>å†…å¡«å…¥ä½¿ç”¨çš„æ¨¡æ¿, ä»¥é€—å·éš”å¼€, å¦‚æœä¸å¡«é»˜è®¤ä¸ºä¸é…ç½®æ¨¡æ¿ã€‚å¯é€‰å€¼: ts,cesium,stylus,dll,allã€‚allä¸ºé…ç½®æ‰€æœ‰æ¨¡æ¿')
    .description('React + Ts + Stylus + Cesium + dllè„šæ‰‹æ¶')
    .action(async (projectName, options) => {
        const message = await figlet(`create   ${projectName}`)
        console.log(chalk.rgb(255, 192, 203)(message))
        setTimeout(() => {
            console.log(chalk.blue(`ğŸš€ hym-react-cli v${packageJson.version}`))
            setTimeout(async () => {
                // è¿‡æ»¤æ— ç”¨çš„é…ç½®é¡¹
                const template = ['cesium', 'stylus', 'dll']
                const split = [...new Set(options.template?.split(','))]
                if (split.includes('all')) {
                    await create(projectName, true, template)
                } else {
                    await create(projectName, split.includes('ts'), split.filter(item => template.includes(item)))
                }
            }, 1000)
        }, 1000)
    })

program.parse(process.argv)
